<div class="max-w-5xl mx-auto px-6 py-10 pt-28">
  <!-- Class Header -->
  <div class="mb-8 text-center">
    <img 
      src="{{kelas.gambar}}" 
      alt="{{kelas.nama_kelas}}" 
      class="mx-auto w-full max-w-md h-auto object-contain rounded shadow mb-4" 
    />
    <h1 class="text-3xl text-gray-900 font-bold mb-2">{{kelas.nama_kelas}}</h1>
    <p class="text-gray-700">{{kelas.deskripsi}}</p>
  </div>

  <!-- Weeks -->
  <div class="mb-10">
    <h2 class="text-2xl text-gray-900 font-semibold mb-4">Weeks</h2>

    <div class="space-y-4">

      {{#each minggu}}
      {{#if progres_minggu.[0].quiz}}
      <div x-data="{ openMinggu: false }" class="border rounded-2xl shadow bg-white overflow-hidden">
        
        <!-- Toggle Week -->
        <button 
          @click="openMinggu = !openMinggu" 
          class="w-full flex justify-between items-center px-6 py-4 bg-white hover:bg-gray-200 transition text-left"
        >
          <h2 class="font-bold text-xl text-gray-900">
            Week {{this.minggu_ke}} : {{this.keterangan}}
          </h2>
          <svg 
            :class="{'rotate-180': openMinggu}" 
            class="w-6 h-6 text-gray-600 transition-transform" 
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <!-- Week Content -->
        <div x-show="openMinggu" x-collapse class="px-6 pb-6 space-y-6">
          
          <!-- Sessions -->
          <div class="space-y-4">
            {{#each this.pertemuan}}
            {{#if this.progres_pertemuan.[0].materi}}
            <div x-data="{ open: false }" class="border rounded-xl shadow bg-white overflow-hidden">
              <!-- Toggle Session -->
              <button 
                @click="open = !open" 
                class="w-full flex justify-between items-center px-6 py-4 text-left hover:bg-gray-50 transition"
              >
                <div>
                  <h3 class="font-bold text-lg text-gray-800">
                    Session {{pertemuan_ke}} - {{topik}}
                  </h3>
                  <p class="text-sm text-gray-500">
                    {{formatTanggal tanggal}} | {{formatTime waktu_awal}} - {{formatTime waktu_akhir}}
                  </p>
                </div>
                <svg 
                  :class="{'rotate-180': open}" 
                  class="w-5 h-5 text-gray-600 transition-transform" 
                  fill="none" 
                  stroke="currentColor" 
                  viewBox="0 0 24 24"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>

              <!-- Session Content -->
              <div x-show="open" x-collapse class="px-6 pb-6">
                {{#if (hasUserAbsen absen ../../user.id)}}
                  <!-- Already Attended -->
                  <span class="inline-block mb-4 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">
                    Attendance recorded
                  </span>

                  <!-- Materials -->
                  <div class="mb-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Materials</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                      <a href="/materis/pdf/{{id}}" 
                         class="block bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow p-4 text-center hover:scale-105 transform transition">
                        PDF
                      </a>
                      <a href="/materis/video/{{id}}" 
                         class="block bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow p-4 text-center hover:scale-105 transform transition">
                        Video
                      </a>
                      <a href="/materis/ppt/{{id}}" 
                         class="block bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow p-4 text-center hover:scale-105 transform transition">
                        PPT
                      </a>
                    </div>
                  </div>

                  <!-- Assignments -->
                  <div class="mt-4">
                    {{#each tugas}}
                    <a 
                      href="/jawaban-tugass/{{../id}}/{{this.id}}"
                      class="block px-6 py-3 text-center bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow-lg hover:scale-105 w-full transform transition"
                    >
                      View Assignment
                    </a>
                    {{/each}}
                  </div>
{{#if (roles logbook.[0].proses "acc")}}
  <div class="mt-4">
    <a href="/logbook/{{id}}"
       class="block w-full px-4 py-2 bg-green-600 text-white text-center rounded-lg shadow hover:bg-green-700 transition">
      View Log Book
    </a>
  </div>
{{else if (roles logbook.[0].proses "rejected")}}
  <div class="mt-4">
    <a href="/logbook/formEdit/{{id}}"
       class="block w-full px-4 py-2 bg-red-600 text-white text-center rounded-lg shadow hover:bg-red-700 transition">
      Update Log Book
    </a>
  </div>
{{else if (roles logbook.[0].proses "proces")}}
  <div class="mt-4">
    <a href="/logbook/{{id}}"
       class="block w-full px-4 py-2 bg-yellow-500 text-white text-center rounded-lg shadow hover:bg-yellow-600 transition">
      Log Book in Process
    </a>
  </div>
{{else}}
  <div class="mt-4">
    <a href="/logbook/formCreate/{{../id}}/{{../../kelas.id}}"
       class="block w-full px-4 py-2 bg-gray-900 text-white text-center rounded-lg shadow hover:bg-gray-700 transition">
      Create Log Book
    </a>
  </div>
{{/if}}

                {{else}}
                  <!-- Not Attended -->
                  <span class="inline-block mb-4 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">
                    Not attended yet
                  </span>

                  <a href="/absens/form/{{id}}" 
                    class="block w-full mb-4 px-4 py-2 bg-gray-900 text-white text-center rounded-lg hover:bg-gray-700 transition">
                    Attendance
                  </a>

                  <div class="opacity-50 pointer-events-none">
                    <h4 class="font-semibold text-gray-700 mb-2">Materials</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                      <button class="block bg-gray-200 text-gray-500 rounded-lg shadow p-4 text-center cursor-not-allowed">PDF</button>
                      <button class="block bg-gray-200 text-gray-500 rounded-lg shadow p-4 text-center cursor-not-allowed">Video</button>
                      <button class="block bg-gray-200 text-gray-500 rounded-lg shadow p-4 text-center cursor-not-allowed">PPT</button>
                    </div>
                  </div>
                {{/if}}
              </div>
            </div>
            {{else}}
            selesaikan pertemuan sebelumnya terlebih dahulu
            {{/if}}
            {{/each}}
          </div>

          <div class="mt-6">
            {{#each this.quiz}}
              {{#if this.pertanyaan.length}}
                  <a href="/quiz/form/{{id}}" 
                     class="block w-full text-center px-6 py-3 bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow-lg hover:scale-105 transform transition">
                    Quiz
                  </a>
              {{else}}
                <p class="text-gray-500 text-center text-sm italic">No quiz available yet</p>
              {{/if}}
            {{/each}}
          </div>

        </div>
      </div>
      {{else}}
      <div class="border rounded-2xl shadow bg-gray-100 overflow-hidden opacity-60 cursor-not-allowed">
        <div class="w-full flex justify-between items-center px-6 py-4 bg-gray-200">
          <h2 class="font-bold text-xl text-gray-500">
            Week {{this.minggu_ke}} : {{this.keterangan}}
          </h2>
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </div>
        <div class="px-6 py-4 text-gray-500 italic text-sm text-center">
          The previous weekâ€™s quiz must meet the minimum score.
        </div>
      </div>
      {{/if}}
      {{/each}}
      
    </div>
  </div>
</div>
