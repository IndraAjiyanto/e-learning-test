<div class="max-w-5xl mx-auto px-6 py-10 pt-28">
  <!-- Header Kelas -->
  <div class="mb-8 text-center">
    <img 
      src="/uploads/images/{{kelas.gambar}}" 
      alt="{{kelas.nama_kelas}}" 
      class="mx-auto w-full max-w-md h-auto object-contain rounded shadow mb-4" 
    />
    <h1 class="text-3xl font-bold mb-2">{{kelas.nama_kelas}}</h1>
    <p class="text-gray-700">{{kelas.deskripsi}}</p>
  </div>

  <!-- Pertemuan -->
  <div class="mb-10">
    <h2 class="text-2xl font-semibold mb-4">Pertemuan</h2>

    <div class="space-y-4">
      {{#each this.pertemuans}}
      <div 
        x-data="{ open: false }" 
        class="border rounded-xl shadow bg-white overflow-hidden"
      >
        <!-- Tombol Toggle Pertemuan -->
        <button 
          @click="open = !open" 
          class="w-full flex justify-between items-center px-6 py-4 text-left hover:bg-gray-50 transition"
        >
          <div>
            <h3 class="font-bold text-lg text-gray-800">
              Pertemuan {{pertemuan_ke}} - {{topik}}
            </h3>
            <p class="text-sm text-gray-500">
              {{formatTanggal tanggal}} | {{formatTime waktu_awal}} - {{formatTime waktu_akhir}}
            </p>
          </div>
          <svg 
            :class="{'rotate-180': open}" 
            class="w-5 h-5 text-gray-600 transition-transform" 
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <!-- Konten Pertemuan -->
        <div x-show="open" x-collapse class="px-6 pb-6">
          {{#if (hasUserAbsen absen ../user.id)}}
            <!-- Sudah Absen -->
            <span class="inline-block mb-4 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">
              Sudah Absen
            </span>

            <!-- Materi -->
            <div class="mb-4">
              <h4 class="font-semibold text-gray-700 mb-2">Materi</h4>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <a href="/materis/pdf/{{id}}" 
                   class="block bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow p-4 text-center hover:scale-105 transform transition">
                  PDF
                </a>
                <a href="/materis/video/{{id}}" 
                   class="block bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow p-4 text-center hover:scale-105 transform transition">
                  Video
                </a>
                <a href="/materis/ppt/{{id}}" 
                   class="block bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow p-4 text-center hover:scale-105 transform transition">
                  PPT
                </a>
              </div>
            </div>

            <!-- Quiz -->
            {{#if totalPertanyaan}}
              {{#if isAnswered}}
                <a href="/pertanyaans/quiz/{{id}}/{{../user.id}}" 
                   class="inline-block px-6 py-3 bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow-lg hover:scale-105 transform transition">
                  Lihat Quiz
                </a>  
              {{else}}
                <a href="/pertanyaans/quiz/{{id}}" 
                   class="inline-block px-6 py-3 bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow-lg hover:scale-105 transform transition">
                  Mulai Quiz
                </a>
              {{/if}}
            {{else}}
              <p class="text-gray-500 text-sm italic">Belum ada quiz</p>
            {{/if}}

            <!-- Tugas -->
{{#if akhir}}
  <div x-data="{ showTugas: false }" class="mt-4">
    <button 
      @click="showTugas = !showTugas"
      class="px-6 py-3 bg-gradient-to-r from-gray-900 to-gray-700 text-white rounded-lg shadow-lg hover:scale-105 transform transition"
    >
      Lihat Tugas
    </button>

    <div class="mt-4 p-4 border rounded-lg bg-gray-50 shadow-inner">
      <h4 class="font-semibold text-gray-800 mb-2">Kirim Tugas Anda</h4>
      <p class="text-sm text-gray-600 mb-3">
        Masukkan link GitHub, Google Drive, atau file online.
      </p>

      <!-- form kirim jawaban -->
      <form action="/tugas/submit/{{id}}" method="POST" class="space-y-3 mb-4">
        <input 
          type="text" 
          name="file" 
          placeholder="https://drive.google.com/..." 
          class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700"
        >
        <button 
          type="submit" 
          class="px-4 py-2 bg-gray-900 text-white rounded-lg shadow hover:bg-gray-700 transition"
        >
          Kirim Jawaban
        </button>
      </form>

      <!-- list jawaban -->
      <div>
        <h5 class="font-semibold text-gray-700 mb-2">Jawaban Anda</h5>
        {{#if jawabanTugas.length}}
          <ul class="space-y-2">
            {{#each jawabanTugas}}
              <li class="flex items-center justify-between p-3 bg-white rounded-lg shadow border">
                <button 
                  type="button"
                  @click="previewLink='{{this.link}}'"
                  class="text-blue-600 hover:underline truncate text-left"
                >
                  {{this.link}}
                </button>
                <span class="text-xs text-gray-500">
                  {{formatTanggal this.createdAt}}
                </span>
              </li>
            {{/each}}
          </ul>
        {{else}}
          <p class="text-sm text-gray-500 italic">Belum ada jawaban yang dikirim.</p>
        {{/if}}
      </div>
    </div>

    <!-- modal preview -->
    <div 
      x-show="showTugas"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl shadow-lg max-w-3xl w-full p-4 relative">
        <button 
          @click="showTugas = !showTugas" 
          class="absolute top-2 right-2 text-gray-600 hover:text-gray-900"
        >
          âœ•
        </button>
        <h3 class="text-lg font-semibold mb-3">Preview Jawaban {{#each tugas}}'/uploads/pdf/{{file}}'{{/each}}</h3>
        <iframe 
          :src={{#each tugas}}'/uploads/pdf/{{file}}'{{/each}}
          class="w-full h-[500px] border rounded"
          type="application/pdf"
        ></iframe>
      </div>
    </div>
  </div>
{{/if}}



          {{else}}
            <span class="inline-block mb-4 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">
              Belum Absen
            </span>

            <a href="/absens/form/{{id}}" 
              class="block w-full mb-4 px-4 py-2 bg-gray-900 text-white text-center rounded-lg hover:bg-gray-700 transition">
              Isi Absen Dulu
            </a>

            <div class="opacity-50 pointer-events-none">
              <h4 class="font-semibold text-gray-700 mb-2">Materi</h4>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button class="block bg-gray-200 text-gray-500 rounded-lg shadow p-4 text-center cursor-not-allowed">PDF</button>
                <button class="block bg-gray-200 text-gray-500 rounded-lg shadow p-4 text-center cursor-not-allowed">Video</button>
                <button class="block bg-gray-200 text-gray-500 rounded-lg shadow p-4 text-center cursor-not-allowed">PPT</button>
              </div>

              <h4 class="font-semibold text-gray-700 mt-4 mb-2">Quiz</h4>
              <button class="inline-block px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                Mulai Quiz
              </button>
            </div>
          {{/if}}
        </div>
      </div>
      {{/each}}
    </div>
  </div>
</div>
